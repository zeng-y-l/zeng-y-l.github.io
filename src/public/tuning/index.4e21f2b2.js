(()=>{"use strict";var t={647:function(t,e,r){var n=r(490),i=r(323);let l=r.p+"defs.a12e6e20.svg";var o=r(699),a=r.n(o);let d="track-DeXC1p",u="tone-MbQnNk",s="tonic-oop0Zf",v="selected-ScZGM3",h="row-EItnfT",c=[2n,3n,5n,7n,11n],p=()=>{let t=a().last(c);t:for(;;){t+=2n;for(let e=0;t%c[e]!==0n;e++)if(t<2n*c[e])break t}c.push(t)},g=t=>{for(;c.length<t;)p()},f=t=>{0===t.length?t.push(0):t[0]=0,g(t.length);let e=1n,r=1n;for(let n=1;n<t.length;n++)t[n]>0?e*=c[n]**BigInt(t[n]):r*=c[n]**BigInt(-t[n]);for(;e<r;t[0]++)e*=2n;for(;e>2n*r;t[0]--)r*=2n;let n=1200*Math.log2(Number(e)/Number(r));return{幂:t,分子:e,分母:r,音分:n}},b=f([]),m={幂:[1],分子:2n,分母:1n,音分:1200},$=(t,e)=>{let r=Array.from(t.幂),n=Math.abs(e),i=r.length;return i<=n&&(r.length=n+1),r.fill(0,i),r[n]+=Math.sign(e),f(r)},y=(t,e)=>a()(t.幂).zipWith(e.幂,function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e-t}).dropRightWhile(t=>0===t).thru(f).value(),k=t=>a()(t).flatMap(e=>t.map(t=>y(e,t))).sortBy(t=>{let{音分:e}=t;return e}).sortedUniqBy(t=>{let{音分:e}=t;return e}).value(),M=(t,e)=>a()(t.幂).zipWith(e.幂,function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e-t}).tail().reduce((t,e,r)=>0===e?t:"EQ"!==t||1!==Math.abs(e)?"ERR":e*(r+1),"EQ"),x=t=>t.map(e=>a()(t).map((t,r)=>[M(e,t),r]).filter(t=>{let[e]=t;return a().isNumber(e)}).fromPairs().value());var C=r(801),T=r(988),P=r(481),S=(0,i.XK)("<div><div><div>"),F=(0,i.XK)("<div>"),L=(0,i.XK)("<sup>"),O=(0,i.XK)("<div><div>(<!>) </div><div><div></div></div><div> / "),B=(0,i.XK)(`<div><div></div><div><button type=button>作为主音</button><button type=button>显示更少</button><button type=button>显示更多</button></div><div><button type=button>清空</button><button type=button>存档`),w=(0,i.XK)("<button type=button> (<!>)"),K=(0,i.XK)(`<button type=button>\xd7`),X=(0,i.XK)(`<button type=button>\xf7`),E=(0,i.XK)("<div><svg viewBox=-51,0,102,100 preserveAspectRatio=none><path fill=none vector-effect=non-scaling-stroke>"),j=(0,i.XK)("<div><table><tbody><tr>"),q=(0,i.XK)("<td>");let U=(0,n.kr)(),I=()=>{var t,e,r;let l=(0,n.qp)(U);return r=(e=(t=S()).firstChild).firstChild,(0,i.$T)(e,(0,n.LM)(n.U2,{get each(){return l.音},children:t=>{var e;return e=F(),(0,n.F3)(r=>{var n={[u]:!0,[s]:0===t.音分,[v]:t.选},l=`${t.音分/12}%`;return r.e=(0,i.s1)(e,n,r.e),l!==r.t&&(null!=(r.t=l)?e.style.setProperty("left",l):e.style.removeProperty("left")),r},{e:void 0,t:void 0}),e}}),null),(0,n.F3)(n=>{var l="minimap-aOPdjE",o="bar-xkqiyj";return l!==n.e&&(0,i.ok)(t,n.e=l),d!==n.t&&(0,i.ok)(e,n.t=d),o!==n.a&&(0,i.ok)(r,n.a=o),n},{e:void 0,t:void 0,a:void 0}),t},W=t=>{var e,r,l,o,d,u,s;let v=e=>{let r=a()(t.音.幂).map(e).flatMap((t,e)=>{var r;return t>0?[c[e].toString(),(r=L(),(0,i.$T)(r,t),r)]:[]}).value();return 0===r.length?1:r};return d=((l=(r=(e=O()).firstChild).firstChild.nextSibling).nextSibling,o=r.nextSibling).firstChild,s=(u=o.nextSibling).firstChild,(0,i.$T)(r,()=>t.i,l),(0,i.$T)(r,()=>t.音.音分.toFixed(2),null),(0,i.$T)(o,()=>t.音.分子.toString(),d),(0,i.$T)(o,()=>t.音.分母.toString(),null),(0,i.$T)(u,()=>v(t=>t),s),(0,i.$T)(u,()=>v(t=>-t),null),(0,n.F3)(t=>{var r="tonedata-rIPM0H",n="frac-FHSe00",l="line-yZRJtE";return r!==t.e&&(0,i.ok)(e,t.e=r),n!==t.t&&(0,i.ok)(o,t.t=n),l!==t.a&&(0,i.ok)(d,t.a=l),t},{e:void 0,t:void 0,a:void 0}),e},A=()=>{var t,e,r,l,o,d,u,s,v;let p=(0,n.qp)(U),[f,m]=(0,n.gQ)(3),k=()=>1!==p.选.length,M=()=>p.选[0],x=()=>p.音[M()],C=t=>{let e;p.set音(r=>{let n=$(x(),t);return e=a().sortedIndexBy(r,n,t=>t.音分),(r=Array.from(r)).splice(e,0,n),r}),p.set选(e)},S={Backspace:{ctrl:!1,name:"删除",disabled:()=>k()||0===x().音分,run(){p.set音(t=>((t=Array.from(t)).splice(M(),1),t))}},z:{ctrl:!0,name:"撤销",disabled:()=>!p.能撤销,run:()=>p.撤销()},y:{ctrl:!0,name:"重做",disabled:()=>!p.能重做,run:()=>p.重做()},Escape:{ctrl:!1,name:"取消选择",disabled:()=>0===p.选.length,run:()=>p.取消选()}};return(0,n.GW)((0,n.on)((0,P.ax)(),t=>{if(!t)return;let e=S[t.key];!e||e.ctrl!==t.ctrlKey||e.disabled()||e.run()})),d=(o=(l=(r=(e=(t=B()).firstChild).nextSibling).firstChild).nextSibling).nextSibling,v=(s=(u=r.nextSibling).firstChild).nextSibling,(0,i.$T)(e,()=>a()(S).map((t,e)=>{var r,l,o,a;let{ctrl:d,name:u,disabled:s,run:v}=t;return(o=(l=(r=w()).firstChild).nextSibling).nextSibling,(0,i.Oo)(r,"click",v,!0),(0,i.$T)(r,u,l),(0,i.$T)(r,d&&"Ctrl + ",o),(0,i.$T)(r,(a=(0,n.Py)(()=>1===e.length),()=>a()?e.toUpperCase():e),o),(0,n.F3)(()=>r.disabled=s()),r}).value()),l.$$click=()=>{p.set音(t=>a()(t).map(t=>y(x(),t)).sortBy(t=>{let{音分:e}=t;return e}).value())},(0,i.$T)(r,(0,n.LM)(T.e,{start:1,get to(){return g(f()),f()},children:t=>{var e,r;return[((e=K()).firstChild,e.$$click=()=>C(t),(0,i.$T)(e,()=>c[t].toString(),null),(0,n.F3)(()=>e.disabled=k()||a().has(x().生,t)),e),((r=X()).firstChild,r.$$click=()=>C(-t),(0,i.$T)(r,()=>c[t].toString(),null),(0,n.F3)(()=>r.disabled=k()||a().has(x().生,-t)),r)]}}),o),o.$$click=()=>m(t=>t-1),d.$$click=()=>m(t=>t+1),s.$$click=()=>p.set音(()=>[b]),v.$$click=()=>p.存档(),(0,n.F3)(n=>{var a="editarea-ZrDErl",d=k()||0===x().音分,v=3>f(),c=p.音.length<2;return a!==n.e&&(0,i.ok)(t,n.e=a),h!==n.t&&(0,i.ok)(e,n.t=h),h!==n.a&&(0,i.ok)(r,n.a=h),d!==n.o&&(l.disabled=n.o=d),v!==n.i&&(o.disabled=n.i=v),h!==n.n&&(0,i.ok)(u,n.n=h),c!==n.s&&(s.disabled=n.s=c),n},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),t},Q=()=>{var t,e,r;let o=(0,n.qp)(U);return r=(e=(t=S()).firstChild).firstChild,(0,i.$T)(e,(0,n.LM)(n.U2,{get each(){return o.音},children:(t,e)=>(0,n.LM)(n.U2,{get each(){return a()(t.生).filter((t,e)=>"-"!==e[0]).sort().value()},children:r=>{var a,d;let u=()=>Math.min(e(),r),s=()=>Math.max(e(),r),h=()=>Math.max(-20,150-(s()-u()+2)**.8*30),c=()=>t.选||o.音[r].选;return d=(a=E()).firstChild.firstChild,(0,n.F3)(t=>{var e={"path-BEqwh5":!0,[v]:c()},n=`${2*u()+2} / ${2*s()+2}`,o=c()?3:1,p=`url(${l}#${c()?"sel":""}path)`,g=s()===r?"":"transform: scaleX(-1);",f=`M -50,100 C -30,${h()} 30,${h()} 50,100`;return t.e=(0,i.s1)(a,e,t.e),n!==t.t&&(null!=(t.t=n)?a.style.setProperty("grid-column",n):a.style.removeProperty("grid-column")),o!==t.a&&(0,i.P$)(d,"stroke-width",t.a=o),p!==t.o&&(0,i.P$)(d,"stroke",t.o=p),t.i=(0,i.oB)(d,g,t.i),f!==t.n&&(0,i.P$)(d,"d",t.n=f),t},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),a}})}),r),(0,i.$T)(e,(0,n.LM)(n.U2,{get each(){return o.音},children:(t,e)=>{var r;return(r=F()).$$click=()=>o.set选(e()),(0,i.$T)(r,(0,n.LM)(W,{音:t,get i(){return e()+1}})),(0,n.F3)(n=>{var l={[u]:!0,[s]:0===t.音分,[v]:t.选},o=`${2*e()+1} / ${2*e()+3}`;return n.e=(0,i.s1)(r,l,n.e),o!==n.t&&(null!=(n.t=o)?r.style.setProperty("grid-column",o):r.style.removeProperty("grid-column")),n},{e:void 0,t:void 0}),r}}),r),r.$$click=()=>o.set选(0),(0,i.$T)(r,(0,n.LM)(W,{音:m,get i(){return o.音.length+1}})),(0,i.$T)(e,(0,n.LM)(n.U2,{get each(){return o.选的音程},children:t=>{var e;let{来:r,去:l,音程:a}=t,d=Math.min(r,l),u=Math.max(r,l);return(e=F()).style.setProperty("grid-column",`${2*d+2} / ${2*u+2}`),(0,i.$T)(e,(0,n.LM)(W,{get 音(){return o.全部音程[a]},i:u-d})),(0,n.F3)(t=>(0,i.s1)(e,{"interval-cqQDKF":!0,"backward-B4F7JY":u===r},t)),e}}),null),(0,n.F3)(n=>{var l="mainarea-MkRqUv",a=`${2*o.音.length+1} / ${2*o.音.length+3}`;return l!==n.e&&(0,i.ok)(t,n.e=l),d!==n.t&&(0,i.ok)(e,n.t=d),n.a=(0,i.s1)(r,{[u]:!0,[s]:!0},n.a),a!==n.o&&(null!=(n.o=a)?r.style.setProperty("grid-column",a):r.style.removeProperty("grid-column")),n},{e:void 0,t:void 0,a:void 0,o:void 0}),t},N=()=>{var t,e;let r=(0,n.qp)(U);return e=(t=j()).firstChild.firstChild.firstChild,(0,i.$T)(e,(0,n.LM)(n.U2,{get each(){return r.全部音程},children:(t,e)=>{var r;return r=q(),(0,i.$T)(r,(0,n.LM)(W,{音:t,get i(){return e()+1}})),(0,n.F3)(e=>(0,i.s1)(r,{[v]:t.选()},e)),r}})),(0,n.F3)(()=>(0,i.ok)(t,"intervals-eWWGCI")),t},R=()=>{let[t,e]=(0,n.gQ)({历史:void 0,当前:[b],未来:void 0}),[r,i]=(0,C.MT)({选:[],音:[],全部音程:[],选的音程:[],set音(t){e(e=>{let{历史:r,当前:n}=e;return{历史:[n.map(t=>{let{幂:e}=t;return Array.from(e)}),r],当前:t(n),未来:void 0}})},get 能撤销(){return null!=t().历史},撤销(){e(t=>{let{历史:e,当前:r,未来:n}=t;return{历史:e[1],当前:e[0].map(f),未来:[r.map(t=>{let{幂:e}=t;return Array.from(e)}),n]}})},get 能重做(){return null!=t().未来},重做(){e(t=>{let{历史:e,当前:r,未来:n}=t;return{历史:[r.map(t=>{let{幂:e}=t;return Array.from(e)}),e],当前:n[0].map(f),未来:n[1]}})},set选(t){i("音",t,"选",e=>(e?i("选",e=>a().without(e,t)):r.选.length<2?i("选",e=>[...e,t]):(i("音",r.选[1],"选",!1),i("选",e=>{let[r]=e;return[r,t]})),!e))},取消选(){(0,n.dC)(()=>{r.选.forEach(t=>i("音",t,"选",!1)),i("选",[]),i("选的音程",[])})},存档(){let e,n=prompt("请复制或粘贴存档（以下是当前存档，留空则不更改）",JSON.stringify(t().当前.map(t=>{let{幂:e}=t;return e})));try{n&&(e=JSON.parse(n))}catch{}e&&r.set音(()=>e.map(f))}}),l=(0,n.P1)(()=>r.选的音程,(t,e)=>e.some(e=>e.音程===t)),o=t=>a()(r.全部音程).map("音分").sortedIndexOf(t.音分);return(0,n.GW)((0,n.on)(t,t=>{let{当前:e}=t;r.取消选();let n=k(e).map((t,e)=>({...t,选:()=>l(e)}));i("全部音程",(0,C.BH)(n,{key:"音分"}));let a=x(e),d=e.map((t,e,r)=>({...t,生:a[e],音程:o(y(t,r[(e+1)%r.length])),选:!1}));i("音",(0,C.BH)(d,{key:"音分"}))})),(0,n.GW)((0,n.on)(()=>r.选,(t,e)=>{let n;if(0===r.选的音程.length||2===t.length||(null==e?void 0:e.length)===2){if(2!==t.length)n=r.音.map((t,e)=>{let{音程:r}=t;return{来:e,去:e+1,音程:r}});else{let e=y(r.音[t[0]],r.音[t[1]]);n=[{来:t[0],去:t[1],音程:o(e)}]}i("选的音程",n)}})),(0,n.LM)(U.Provider,{value:r,get children(){return[(0,n.LM)(I,{}),(0,n.LM)(A,{}),(0,n.LM)(Q,{}),(0,n.LM)(N,{})]}})};(0,i.Qj)(["click"]);let G=document.getElementById("root");(0,i.sY)(()=>(0,n.LM)(R,{}),G)}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var l=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(l.exports,l,l.exports,r),l.loaded=!0,l.exports}r.m=t,r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(t){if("object"==typeof window)return window}})(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t=[];r.O=(e,n,i,l)=>{if(n){l=l||0;for(var o=t.length;o>0&&t[o-1][2]>l;o--)t[o]=t[o-1];t[o]=[n,i,l];return}for(var a=1/0,o=0;o<t.length;o++){for(var[n,i,l]=t[o],d=!0,u=0;u<n.length;u++)(!1&l||a>=l)&&Object.keys(r.O).every(t=>r.O[t](n[u]))?n.splice(u--,1):(d=!1,l<a&&(a=l));if(d){t.splice(o--,1);var s=i();void 0!==s&&(e=s)}}return e}})(),r.p="./",r.rv=()=>"1.3.0",(()=>{var t={980:0};r.O.j=e=>0===t[e];var e=(e,n)=>{var i,l,[o,a,d]=n,u=0;if(o.some(e=>0!==t[e])){for(i in a)r.o(a,i)&&(r.m[i]=a[i]);if(d)var s=d(r)}for(e&&e(n);u<o.length;u++)l=o[u],r.o(t,l)&&t[l]&&t[l][0](),t[l]=0;return r.O(s)},n=self.webpackChunktuning=self.webpackChunktuning||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),r.ruid="bundler=rspack@1.3.0";var n=r.O(void 0,["395"],function(){return r(647)});n=r.O(n)})();